<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Chase Game</title>
    <style>
        /* Setting the border of the canvas element */
        #gameCanvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <!-- Canvas element where the game will be drawn -->
    <canvas id="gameCanvas" width="300" height="500"></canvas>
    <!-- Input field for user's answer -->
    <input type="text" id="userInput" placeholder="Enter your answer...">
    <!-- Submit button to submit the user's answer -->
    <button id="submitButton">Submit</button>
    <!-- Container for the current question and answer -->
    <div id="questionAnswerContainer">
        <p id="question"></p>
        <p id="answer"></p>
    </div>
    <script>
        // Get the question and answer from the rendered template
        const question = "{{ question }}";
        const answer = "{{ answer }}";
        // Get the canvas and its context for drawing
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        // Get the input field, submit button, and question/answer container
        const userInput = document.getElementById('userInput');
        const submitButton = document.getElementById('submitButton');
        const questionAnswerContainer = document.getElementById('questionAnswerContainer');
        // Initialize the current question and movement speed
        let currentQuestion = {};
        let movementSpeed = 2;

        // Function to draw text on the canvas
        function drawText(text, x, y, fontSize) {
            ctx.font = `${fontSize}px Arial`;
            ctx.fillText(text, x, y);
        }

        // Function to animate the game
        function animate() {
            const answer = currentQuestion.answer;
            // Clear the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Draw the current answer on the canvas
            drawText(answer, 150, movementSpeed, 12);
            // Increment the movement speed
            movementSpeed += 1;
            // Reset the movement speed if it exceeds the canvas height
            if (movementSpeed > 480) {
                movementSpeed = 2;
                // Fetch the next question
                fetchNextQuestion();
            }
            // Request the next frame for animation
            requestAnimationFrame(animate);
        }

        // Function to fetch questions from the server
        function fetchQuestions() {
            return fetch('/cardchase')
               .then(response => response.json())
               .then(questions => {
                    return questions;
                });
        }

        // Function to update the current question and answer on the page
        function updateQuestionAnswer() {
            if (Object.keys(currentQuestion).length > 0) {
                const question = currentQuestion.question;
                const answer = currentQuestion.answer;
                // Update the question and answer elements on the page
                questionAnswerContainer.querySelector('#question').innerText = question;
                questionAnswerContainer.querySelector('#answer').innerText = answer;
            }
        }

        // Function to fetch the next question from the server and update the game
        function fetchNextQuestion() {
            fetchQuestions()
                .then(questions => {
                    if (questions.length > 0) {
                        // Set the current question and update the game
                        currentQuestion = questions.shift();
                        updateQuestionAnswer();
                        // Start the animation loop after fetching the question and answer
                        animate();
                    }
                });
        }

        // Function to submit the user's answer
        function submitAnswer() {
            const userAnswer = userInput.value.toLowerCase();
            // Check if the user's answer matches the current answer
            if (userAnswer === currentQuestion.answer.toLowerCase()) {
                // Fetch the next question if the answer is correct
                fetchNextQuestion();
            }
            // Clear the input field
            userInput.value = '';
        }

        // Fetch the first question and start the game
        fetchNextQuestion();
        // Start the animation loop
        animate();

        // Add an event listener to the submit button for submitting the user's answer
        submitButton.addEventListener('click', submitAnswer);
    </script>
</body>
</html>
